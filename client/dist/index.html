<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="IDEA Admin Panel" />
    <meta name="author" content="Ziady Mubaraq" />
    <link href="./image/IDEA_logo.svg" type="image/x-icon" rel="shortcut icon" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,600,0,0" rel="stylesheet" />
    <link href="./css/style.css" rel="stylesheet" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <title>IDEA - Admin Panel</title>
  </head>

  <body>
    <!-- Preloader -->
    <div id="preloader" style="display: none">
      <div class="loading">
        <lottie-player
          src="https://assets2.lottiefiles.com/packages/lf20_remmdtqv.json"
          background="transparent"
          speed="1"
          style="width: 300px; height: 300px"
          loop
          autoplay></lottie-player>
      </div>
    </div>
    <!-- End Preloader -->

    <!-- Navbar -->
    <header class="navbar sticky-top bg-white flex-md-nowrap p-0 shadow" id="navbar" style="display: none">
      <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6">
        <img src="./image/IDEA_logo.svg" width="80" class="d-inline-block me-2" alt="IDEA" />Admin Panel</a
      >
      <button
        class="navbar-toggler position-absolute d-md-none collapsed"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#sidebar-menu"
        aria-controls="sidebar-menu"
        aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    </header>
    <!-- End Navbar -->

    <!-- Login Section -->
    <section class="container" id="login-section" style="display: none">
      <div class="row">
        <div class="col-12 text-center">
          <h1 class="mb-3 mt-5">Login Options</h1>
          <span>Log in and autocomplete your order with your personal data, or sign up to enjoy all the benefits of an IDEA account.</span>
        </div>
        <div class="col-12 col-lg-8 offset-lg-2 my-5">
          <div class="row">
            <div class="col-12 col-md-6 border-end p-5 text-left">
              <div class="form-signin m-auto">
                <form id="register-form">
                  <h1 class="h3 mb-3 display-1">Sign up and enjoy</h1>
                  <div class="mb-3">
                    <div class="d-flex justify-content-between">
                      <label for="register-username">Username</label>
                      <label class="text-danger text-end fw-bold">*</label>
                    </div>
                    <input
                      type="text"
                      class="form-control"
                      id="register-username"
                      placeholder="Enter your username ..."
                      autocomplete="off"
                      required />
                  </div>
                  <div class="mb-3">
                    <div class="d-flex justify-content-between">
                      <label for="register-email">Email</label>
                      <label class="text-danger text-end fw-bold">*</label>
                    </div>
                    <input type="email" class="form-control" id="register-email" placeholder="Enter email address ..." autocomplete="off" required />
                  </div>
                  <div class="mb-3">
                    <div class="d-flex justify-content-between">
                      <label for="register-password">Password</label>
                      <label class="text-danger text-end fw-bold">*</label>
                    </div>
                    <input
                      type="password"
                      class="form-control"
                      id="register-password"
                      placeholder="Enter your password ..."
                      autocomplete="off"
                      required />
                  </div>
                  <div class="mb-3">
                    <label for="register-phone">Phone Number</label>
                    <input type="text" class="form-control" id="register-phone" placeholder="Enter phone number (optional) ..." autocomplete="off" />
                  </div>
                  <div class="mb-3">
                    <label for="register-address">Address</label>
                    <textarea
                      id="register-address"
                      class="form-control"
                      rows="3"
                      placeholder="Enter your address (optional) ..."
                      autocomplete="off"></textarea>
                  </div>
                  <button class="btn btn-lg btn-primary rounded-pill w-100 p-2 mt-3" type="submit">Sign Up</button>
                </form>
              </div>
            </div>
            <div class="col-12 col-md-6 p-5 text-left">
              <div class="form-signin m-auto">
                <form id="login-form">
                  <h1 class="h3 mb-3 display-1">Log in to your account</h1>
                  <span>Log in on your profile to autocomplete your purchase order with your personal data.</span>
                  <div class="mb-3 mt-3">
                    <div class="d-flex justify-content-between">
                      <label for="login-email">Email</label>
                      <label class="text-danger text-end fw-bold">*</label>
                    </div>
                    <input type="email" class="form-control" id="login-email" placeholder="Enter email address ..." autocomplete="off" required />
                  </div>
                  <div class="mb-4">
                    <div class="d-flex justify-content-between">
                      <label for="login-password">Password</label>
                      <label class="text-danger text-end fw-bold">*</label>
                    </div>
                    <input
                      type="password"
                      class="form-control"
                      id="login-password"
                      placeholder="Enter your password ..."
                      autocomplete="off"
                      required />
                  </div>
                  <div class="checkbox mb-3">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="" id="login-remember" />
                      <label class="form-check-label" for="login-remember"> Remember me </label>
                    </div>
                  </div>
                  <button class="btn btn-lg btn-primary rounded-pill w-100 p-2" type="submit" id="login-button">Log In</button>
                </form>
                <br />
                <p style="text-align: center">Or login with</p>
                <!-- COPY DIV GOOGLE YG DIBAWAH -->
                <div id="buttonDiv">
                  <!-- MASI KOSONG -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- End Login Section -->

    <!-- Home Section -->
    <section class="container-fluid" id="home-section" style="display: none">
      <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse" id="sidebar-menu" style="display: none">
          <div class="position-sticky pt-3">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active fw-bold" href="" id="nav-dashboard">
                  <span class="icon material-symbols-outlined me-2">shopping_cart</span>Dashboard</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="nav-product"> <span class="icon material-symbols-outlined me-2">shopping_bag</span>Products</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="nav-category"> <span class="icon material-symbols-outlined me-2">category</span>Categories</a>
              </li>
            </ul>
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted text-uppercase">
              <span>Account</span>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item">
                <a class="nav-link"> <span class="icon material-symbols-outlined me-2">person</span>Hei, <span id="username">Ziady!</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="nav-logout"> <span class="icon material-symbols-outlined me-2">logout</span>Logout</a>
              </li>
            </ul>
          </div>
        </nav>
        <!-- End Sidebar -->

        <!-- Dashboard Section -->
        <section class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="dashboard-section" style="display: none">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="display-2">Dashboard</h1>
          </div>
          <div class="row">
            <div class="col-12 col-md-6">
              <div class="row">
                <div class="col-12 col-md-6 mb-3">
                  <div class="card">
                    <div class="card-body">
                      <h6 class="card-subtitle mb-2 text-muted">Total Products</h6>
                      <h6 class="card-title card-number" id="total-product">0</h6>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-md-6 mb-3">
                  <div class="card">
                    <div class="card-body">
                      <h6 class="card-subtitle mb-2 text-muted">Total Categories</h6>
                      <h6 class="card-title card-number" id="total-category">0</h6>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- End Dashboard Section -->

        <!-- Product Section -->
        <section class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="product-section" style="display: none">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="display-2">Products</h1>
            <button class="btn btn-primary rounded-pill" id="new-product"><span class="icon material-symbols-outlined">add</span>New Product</button>
          </div>
          <div class="row">
            <div class="col-12 table-responsive">
              <table class="table align-middle">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col" width="180px">Image</th>
                    <th scope="col" width="250px">Description</th>
                    <th scope="col">Category</th>
                    <th scope="col">Price</th>
                    <th scope="col">Author</th>
                    <th scope="col" width="50px"></th>
                  </tr>
                </thead>
                <tbody id="table-product"></tbody>
                <!-- SUDAH DIPINDAH DI BAWAH DATANYA SECARA DINAMIS -->
              </table>
            </div>
          </div>
        </section>
        <!-- End Product Section -->

        <!-- New Product Section -->
        <section class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="new-product-section" style="display: none">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="display-2">New Product</h1>
          </div>
          <div class="row">
            <div class="col-12 col-md-6">
              <form id="product-form">
                <div class="mb-3">
                  <label for="product-name">Name <span class="text-danger fw-bold">*</span></label>
                  <input type="text" class="form-control" id="product-name" placeholder="Enter product name" autocomplete="off" required />
                </div>
                <div class="mb-3">
                  <label for="product-category">Category <span class="text-danger fw-bold">*</span></label>
                  <select id="product-category" class="form-select" required>
                    <option value="" selected disabled>-- Select Category --</option>
                    <option value="1">Furniture</option>
                    <option value="2">Workspace</option>
                    <option value="3">Storage</option>
                    <option value="4">Textile</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="product-desc">Description <span class="text-danger fw-bold">*</span></label>
                  <input type="text" class="form-control" id="product-desc" placeholder="Enter product description" autocomplete="off" required />
                </div>
                <div class="row">
                  <div class="col-12 col-md-6">
                    <div class="mb-3">
                      <label for="product-stock">Stock <span class="text-danger fw-bold">*</span></label>
                      <input
                        type="number"
                        min="0"
                        class="form-control"
                        id="product-stock"
                        placeholder="Enter product stock"
                        autocomplete="off"
                        required />
                    </div>
                  </div>
                  <div class="col-12 col-md-6">
                    <div class="mb-3">
                      <label for="product-price">Price <span class="text-danger fw-bold">*</span></label>
                      <input
                        type="number"
                        min="0"
                        class="form-control"
                        id="product-price"
                        placeholder="Enter product price"
                        autocomplete="off"
                        required />
                    </div>
                  </div>
                </div>
                <div class="mb-3">
                  <label for="product-image">Image <span class="text-danger fw-bold">*</span></label>
                  <input type="text" class="form-control" id="product-image" placeholder="Enter product image url" autocomplete="off" required />
                </div>
                <div class="row mt-5 mb-3">
                  <div class="col-6">
                    <a class="btn btn-lg btn-light rounded-pill w-100 p-2" id="cancel-button" href="">Cancel</a>
                  </div>
                  <div class="col-6">
                    <button class="btn btn-lg btn-primary rounded-pill w-100 p-2" type="submit" href="">Submit</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </section>
        <!-- End New Product Section -->

        <!-- Category Section -->
        <section class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="category-section" style="display: none">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="display-2">Categories</h1>
            <button class="btn btn-primary rounded-pill" id="new-category">
              <span class="icon material-symbols-outlined">add</span>New Category
            </button>
          </div>
          <div class="row">
            <div class="col-12">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col" width="50px"></th>
                  </tr>
                </thead>
                <tbody id="table-category">
                  <!-- DATA SUAH DIGANTI PAKE DINAMIS DIBAWAH -->
                </tbody>
              </table>
            </div>
          </div>
        </section>
        <!-- End Category Section -->

        <!-- New Category Section -->
        <section class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="new-category-section" style="display: none">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="display-2">New Category</h1>
          </div>
          <div class="row">
            <div class="col-12 col-md-6">
              <form id="category-form">
                <div class="mb-3">
                  <label for="category-name">Name <span class="text-danger fw-bold">*</span></label>
                  <input type="text" class="form-control" id="category-name" placeholder="Enter category name" autocomplete="off" required />
                </div>
                <div class="row mt-5 mb-3">
                  <div class="col-6">
                    <a class="btn btn-lg btn-light rounded-pill w-100 p-2" href="">Cancel</a>
                  </div>
                  <div class="col-6">
                    <button class="btn btn-lg btn-primary rounded-pill w-100 p-2" type="submit" href="">Submit</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </section>
        <!-- End New Category Section -->
      </div>
    </section>
    <!-- End Home Section -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
      crossorigin="anonymous"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <!-- SCRIPT -->
    <!-- 1. REQUIRE SCRIPT DI HEADER DI https://releases.jquery.com/ PILIH YG PLG ATAS YG MINIFIED <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>-->
    <!-- 2. BUAT SCRIPT! -->
    <!-- 3. BUAT GOOGLE LOGIN -->
    <script>
      //COPAS FUNCTION GOOGLE TD
      const baseUrl = "https://cuisines.flixy.online";
      // const baseUrl = "http://localhost:3000";
      async function handleCredentialResponse(response) {
        // console.log("Encoded JWT ID token: " + response.credential);
        // manipulasi send pakai header pakai ajax
        try {
          const responseData = await $.ajax({
            url: baseUrl + "/google-login",
            method: "POST",
            headers: {
              google_token: response.credential,
            },
          });
          // console.log(responseData, "ini responseee");
          //save access_token ke local storage
          localStorage.setItem("access_token", responseData.access_token); //dpt dari controller .json
          // juga bisa
          // localStorage.access_token = responseData.access_token

          //ganti nama user di front end
          $("#username").html(/*html*/ responseData.name);

          //samain dengan login form
          $("#navbar").show();
          $("#sidebar-menu").show();
          $("#dashboard-section").show();
          $("#home-section").show();
          $("#login-section").hide();
          fetchCuisineAndUser(); // yg tadi utk data dinamis
          fetchCategories();
          const Toast = Swal.mixin({
            toast: true,
            position: "top-end",
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
              toast.addEventListener("mouseenter", Swal.stopTimer);
              toast.addEventListener("mouseleave", Swal.resumeTimer);
            },
          });

          Toast.fire({
            icon: "success",
            title: "Signed in successfully",
          });
        } catch (error) {
          console.log(error);
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: "Login failed",
          });
        }
      }
      window.onload = function () {
        //BAGIAN BAWAH INI MAU DIPINDAH KE DALAM DOCUMENT.READY JUGA BISA KALAU AD ERROR
        google.accounts.id.initialize({
          client_id: "87973030685-3mlll838f2nmrj2445nlidjo9v77btv2.apps.googleusercontent.com",
          callback: handleCredentialResponse,
        });
        google.accounts.id.renderButton(
          document.getElementById("buttonDiv"),
          { theme: "outline", size: "large" } // customization attributes
        );
      };

      // DELETE DATA
      //PAKE AJAX DELETE
      const deleteCuisine = async (id) => {
        try {
          const confirmation = await Swal.fire({
            title: "Are you sure?",
            text: "You won't be able to revert this!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, delete it!",
          });
          if (confirmation.isConfirmed) {
            const cuisine = await $.ajax({
              method: "DELETE",
              url: baseUrl + "/cuisines/" + id,
              headers: {
                //taruh header biar g invalid token
                access_token: localStorage.getItem("access_token"), //ambil access token dr local storage
              },
            });
            Swal.fire("Deleted!", cuisine.message, "success");
            fetchCuisineAndUser();
          }
        } catch (error) {
          console.log(error, "ERROR DELETE");
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: error.responseJSON.message,
          });
        }
      };

      //GANTI DATA SI PRODUCT BIAR DINAMIS SESUAI DATABASE
      //PAKE AJAX GET
      //TRUS TARUH DI JIKA SUDAH ADA ACCESS_TOKEN DAN SUDAH LOGIN
      const fetchCuisineAndUser = async () => {
        try {
          const userCuisine = await $.ajax({
            method: "GET",
            url: baseUrl + "/cuisines",
            headers: {
              //taruh header biar g invalid token
              access_token: localStorage.getItem("access_token"), //ambil access token dr local storage
            },
          });
          // console.log(userCuisine, "Response fetch cuisine");
          //ADA 2 CARA
          //1. EMPTY DULU DATA BODYNYA KEMUDIAN PAKE APPEND SEBANYAK DATA YG ADA DI DATABASE PAKE LOOP
          //2. PAKE .HTML PAKE LOOP
          //CARA 1 =
          $("#table-product").empty();

          userCuisine.forEach((el, index) => {
            let priceFormat = new Intl.NumberFormat("id-ID", {
              style: "currency",
              currency: "IDR",
            }).format(el.price);
            console.log(priceFormat, "<<<<<<< INI PRICE FORMAT");
            $("#table-product").append(/*html*/ `
          <tr>
            <td scope="row">${index + 1}</td>
            <td class="fw-bold">${el.name}</td>
            <td>
              <img src="${el.imgUrl}" class="img-fluid" />
            </td>
            <td>${el.description}</td>
            <td>${el.Category.name}</td>
            <td class="fw-bold">${priceFormat} </td>
            <td>${el.User.email} </td>
            <td>
              <div href="" class="ms-3"><span class="icon material-symbols-outlined text-danger" onclick="deleteCuisine(${el.id})">delete</span></div>
              </td>
              </tr>
              `);
            //CARA KE 2 PAKE HTML
            $("#total-product").html(/*html*/ userCuisine.length);
          });
        } catch (error) {
          //tambahan aja misal token salah atau unauthorized maka hapus access token dengan local storage remove item
          if (error.status === 401) {
            localStorage.removeItem("access_token");
          }
          console.log(error);
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: error.responseJSON.message,
          });
        }
      };

      const fetchCategories = async () => {
        try {
          const categories = await $.ajax({
            method: "GET",
            url: baseUrl + "/categories",
            headers: {
              //taruh header biar g invalid token
              access_token: localStorage.getItem("access_token"), //ambil access token dr local storage
            },
          });

          // console.log(categories, "INI FECTH CATEGORIES");
          $("#table-category").empty();
          categories.forEach((el, index) => {
            // Create a new table row for each category and append it to the table
            $("#table-category").append(/*html*/ `
            <tr>
              <td scope="row">#${index + 1}</td>
              <td class="fw-bold">${el.name}</td>
              <td>
                <a href="" class="ms-3"><span class="icon material-symbols-outlined text-danger">delete</span></a>
              </td>
            </tr>
            `);
            //PAKE HTML
            $("#total-category").html(/*html*/ categories.length);

            //UNTUK UBAH SELECTION JD DINAMIS
            $("#product-category").empty();
            $("#product-category").append(/*html*/ `
              <option value="" selected disabled>-- Select Category --</option>
              <option value=${el.id}>${el.name}</option>
              `);
          });
        } catch (error) {
          //tambahan aja misal token salah atau unauthorized maka hapus access token dengan local storage remove item
          if (error.status === 401) {
            localStorage.removeItem("access_token");
          }
          console.log(error, "ERROR CATEGORIES");
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: error.responseJSON.message,
          });
        }
      };

      const fetchCategories2 = async () => {
        try {
          const categories = await $.ajax({
            method: "GET",
            url: baseUrl + "/categories",
            headers: {
              //taruh header biar g invalid token
              access_token: localStorage.getItem("access_token"), //ambil access token dr local storage
            },
          });
          // console.log(categories, "INI FECTH CATEGORIES 2");
          //UNTUK UBAH SELECTION JD DINAMIS
          $("#product-category").empty();
          $("#product-category").append(/*html*/ `<option value="" selected disabled>-- Select Category --</option>`);
          categories.forEach((el) => {
            $("#product-category").append(/*html*/ `
              <option value=${el.id}>${el.name}</option>
              `);
          });
        } catch (error) {
          //tambahan aja misal token salah atau unauthorized maka hapus access token dengan local storage remove item
          if (error.status === 401) {
            localStorage.removeItem("access_token");
          }
          console.log(error, "ERROR CATEGORIES");
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: error.responseJSON.message,
          });
        }
      };

      $(document).ready(() => {
        //1. REGISTER DAN LOGIN
        // HIDE SMUA ELEMEN, YG DI HIDE DI ELEMENTNYA BKN DI SCRIPT BIAR G GLITCH PAKE STYLE DISPLAY NONE
        //SHOW LOGIN/REGISTER PAGE

        //2. BUAT NAVIGATION GUARD
        const access_token = localStorage.getItem("access_token"); //ambil key dari localStorage yg berisi access_token
        //access_token itu metadata jd sensitif makanya ditaruh di header bkn di body
        //CEK ACCESS TOKEN ADA ATAU TIDAK
        if (access_token) {
          //KALAU SUDAH, KITA SHOW PAGE HOME ATAU NAVBAR ATAU DLL SESUAI KEBUTUHAN
          $("#navbar").show();
          $("#sidebar-menu").show();
          $("#dashboard-section").show();
          $("#home-section").show();
          $("#login-section").hide();
          fetchCuisineAndUser(); // yg tadi utk data dinamis
          fetchCategories();
          console.log("anda sudah login");
        } else {
          //KALAU BELUM SHOW PAGE REGISTER SAMA LOGIN
          $("#login-section").show();
          $("#home-section").hide();
          console.log("anda belum login");
        }

        //misalnya ada function yg merubah variabel, berarti if else diatasnya gbakal jalan lg
        //makanya ditaruh diluar if else biar g usah refresh
        $("#nav-product").click((e) => {
          e.preventDefault();
          // Hide all sections
          $("#dashboard-section").hide();
          $("#home-section").show();
          $("#product-section").show();
          $("#category-section").hide();
          $("#new-category-section").hide();
          $("#new-product-section").hide();
        });

        $("#nav-category").click((e) => {
          e.preventDefault();
          // Hide all sections
          $("#dashboard-section").hide();
          $("#home-section").show();
          $("#product-section").hide();
          $("#category-section").show();
          $("#new-category-section").hide();
          fetchCategories();
        });

        $("#nav-dashboard").click((e) => {
          e.preventDefault();
          // Hide all sections
          $("#dashboard-section").show();
          $("#home-section").show();
          $("#product-section").hide();
          $("#category-section").hide();
          $("#new-category-section").hide();
        });

        // BUAT SINGLE PAGE APPLICATION DLU BIAR DIREFRESH GA RELOAD / SINGLE FRESH / AGAR G DIREFRESH
        //1. PROSES REGISTER
        // AMBIL ID FORM NYA DLU DAN SELECT
        //PAKAI .SUBMIT        //tambah async
        $("#register-form").submit(async function (event) {
          //prevent dari reload/refresh
          event.preventDefault();
          //AMBIL VALUE YG DIBUTUHKAN DARI FORMNYA PAKE .val()
          const username = $("#register-username").val();
          const email = $("#register-email").val();
          const password = $("#register-password").val();
          const phoneNumber = $("#register-phone").val();
          const address = $("#register-address").val();
          //BUAT PROMISE(ASYNC) AJAX DOKUMENTASI ADA DI JQUERY AJAX
          try {
            const responseData = await $.ajax({
              method: "POST",
              url: baseUrl + "/register",
              data: { username, email, password, phoneNumber, address },
            });
            console.log(responseData.message);
            Swal.fire("Good job!", responseData.message, "success");
          } catch (error) {
            console.log(error.responseJSON.message);
            Swal.fire({
              icon: "error",
              title: "Oops...",
              text: error.responseJSON.message,
            });
          }
        });

        //2. LOGIN SAMA KAYAK REGISTER
        $("#login-form").submit(async function (event) {
          //prevent dari reload/refresh
          console.log("KETRIGGER");
          event.preventDefault();
          //AMBIL VALUE YG DIBUTUHKAN DARI FORMNYA PAKE .val()
          const email = $("#login-email").val();
          const password = $("#login-password").val();
          //BUAT PROMISE(ASYNC) AJAX DOKUMENTASI ADA DI JQUERY AJAX
          try {
            const responseData = await $.ajax({
              method: "POST",
              url: baseUrl + "/login",
              data: { email, password },
            });
            // console.log(responseData, "<<<<<<<<<< INI RESPONSE DATA DARI LOGIN FORM");
            $("#navbar").show();
            $("#sidebar-menu").show();
            $("#dashboard-section").show();
            $("#home-section").show();
            $("#login-section").hide();
            //localStorage.setItem
            //dapat dari controller .json login
            localStorage.setItem("access_token", responseData.access_token); //set item ke localstorage // taruh access_token ke localStorage
            fetchCuisineAndUser();
            fetchCategories();
            $("#username").html(`${responseData.username}`);
            const Toast = Swal.mixin({
              toast: true,
              position: "top-end",
              showConfirmButton: false,
              timer: 3000,
              timerProgressBar: true,
              didOpen: (toast) => {
                toast.addEventListener("mouseenter", Swal.stopTimer);
                toast.addEventListener("mouseleave", Swal.resumeTimer);
              },
            });

            Toast.fire({
              icon: "success",
              title: "Signed in successfully",
            });
          } catch (error) {
            console.log(error.responseJSON.message);
            Swal.fire({
              icon: "error",
              title: "Oops...",
              text: error.responseJSON.message,
            });
          }
        });

        // KLIK BUTTON ADD PRODUCT AKAN MENAMPILKAN PAGE FORM ADD NEW PRODUCT
        $("#new-product").click((e) => {
          e.preventDefault();
          fetchCategories2();
          $("#home-section").show();
          $("#new-product-section").show();
          $("#product-section").hide();
          $("#category-section").hide();
          $("#new-category-section").hide();
        });
        //ADD DATA PRODUCTS PAKE AJAX ADD
        $("#new-product-section").submit(async (e) => {
          e.preventDefault();
          const name = $("#product-name").val();
          const categoryId = $("#product-category").val();
          const description = $("#product-desc").val();
          const price = $("#product-price").val();
          const imgUrl = $("#product-image").val();
          try {
            const cuisine = await $.ajax({
              method: "POST",
              url: baseUrl + "/cuisines",
              data: { name, categoryId, description, price, imgUrl },
              headers: {
                //taruh header biar g invalid token
                access_token: localStorage.getItem("access_token"), //ambil access token dr local storage
              },
            });
            $("#home-section").show();
            $("#new-product-section").hide();
            $("#product-section").show();
            fetchCategories2();
            fetchCuisineAndUser();
            Swal.fire({
              position: "top-end",
              icon: "success",
              title: cuisine.message,
              showConfirmButton: false,
              timer: 3000,
            });
          } catch (error) {
            console.log(error);
            console.log(error.responseJSON.message);
            Swal.fire({
              icon: "error",
              title: "Oops...",
              text: error.responseJSON.message,
            });
          }
        });

        $("#cancel-button").click((e) => {
          e.preventDefault();
          fetchCategories2();
          $("#home-section").show();
          $("#new-product-section").hide();
          $("#product-section").show();
          $("#category-section").hide();
          $("#new-category-section").hide();
        });
        //LOCAL STORAGE REMOVE ITEM
        //karna dia tombol maka pake .click
        $("#nav-logout").click((e) => {
          e.preventDefault();
          localStorage.removeItem("access_token");
          $("#login-section").show();
          $("#home-section").hide();
          const Toast = Swal.mixin({
            toast: true,
            position: "top-end",
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
              toast.addEventListener("mouseenter", Swal.stopTimer);
              toast.addEventListener("mouseleave", Swal.resumeTimer);
            },
          });

          Toast.fire({
            icon: "success",
            title: "Logged out successfully",
          });
        });
      });
    </script>
  </body>
</html>
